## 编程作业

引入虚存机制后，原来内核的 sys_get_time 和 sys_task_info 函数实现就无效了；其原因是因为这两个系统调用传入了一个用户地址的引用，在内核态需要将其转换成真实的物理地址

应用程序使用`sys_mmap`即可分配一段内存，`sys_unmap`收回分配给应用程序的内存

## 简答题

SV39 页表项主要由物理页帧号 (PPN) 和一些标志位组成。标志位的作用如下：
- V (有效)：标记页是否有效。
- R/W/X：控制读、写、执行权限。
- U (用户态)：是否允许用户态访问。
- G (全局)：全局共享页面。
- A (访问)：标记页面是否被访问过。
- D (脏页)：标记页面是否被修改过。

哪些异常可能由缺页引起？
- 页不存在（页面还没加载）。
- 权限不足（尝试读写不允许的页面）。

缺页时相关寄存器
- sepc：出错指令的位置。
- stval：出错的虚拟地址。
- scause：缺页原因。

Lazy 策略的好处：
1. 节省启动时间：减少不必要的 I/O。
2. 节省内存：只加载被访问的页面。

SV39 页表内存占用:
如果申请了 10GB 连续虚拟内存，大概要用 20MB 左右的内存来存页表。

如何实现 Lazy 策略?
只有页面被访问时才分配内存。第一次访问触发缺页异常，系统再去分配物理内存并更新页表。

Swap 导致的页面失效：
页面换出时，页表项的 V 位 会设为 0，表示页面无效，等用到时再从磁盘加载。

单页表的切换：
进程切换时更换页表，更新 satp 寄存器。

用户态访问限制：
通过将内核页的 U 位 设为 0，让用户态无法访问。

单页表的优势：
省内存，切换快，不用维护两份表。

双页表的切换时机：
双页表一般在用户态和内核态切换时更换。如果用单页表，选择在进程上下文切换时切换。

## 荣誉准则

1. 在完成本次实验的过程（含此前学习的过程）中，我曾分别与**以下各位**就（与本次实验相关的）以下方面做过交流，还在代码中对应的位置以注释形式记录了具体的交流对象及内容：

    无

2. 此外，我也参考了**以下资料**，还在代码中对应的位置以注释形式记录了具体的参考来源及内容：

    无

3. 我独立完成了本次实验除以上方面之外的所有工作，包括代码与文档。 我清楚地知道，从以上方面获得的信息在一定程度上降低了实验难度，可能会影响起评分。

4. 我从未使用过他人的代码，不管是原封不动地复制，还是经过了某些等价转换。 我未曾也不会向他人（含此后各届同学）复制或公开我的实验代码，我有义务妥善保管好它们。 我提交至本实验的评测系统的代码，均无意于破坏或妨碍任何计算机系统的正常运转。 我清楚地知道，以上情况均为本课程纪律所禁止，若违反，对应的实验成绩将按“-100”分计。
